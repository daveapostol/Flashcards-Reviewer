import React, { useState, useEffect } from 'react';
import { 
  BookOpen, Utensils, Map, Leaf, Zap, ChevronRight, 
  Image as ImageIcon, Loader2, CheckCircle2, AlertTriangle, 
  Info, Globe, Droplets, TrendingUp, Search, Layers, Activity,
  MapPin, Lightbulb, Star, X, MousePointer2, RefreshCw
} from 'lucide-react';

const apiKey = "";

const App = () => {
  const [activeTab, setActiveTab] = useState('Agricultural Systems');
  const [loadingImage, setLoadingImage] = useState(false);
  const [sectionImages, setSectionImages] = useState({});
  const [errorMessage, setErrorMessage] = useState(null);
  const [selectedTag, setSelectedTag] = useState(null);

  // NEW: Scroll to top whenever the tab changes
  useEffect(() => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }, [activeTab]);

  const tagDefinitions = {
    // Case Study Vault Tags
    "Drought & Desertification": "Physical factors where rain failure causes the Sahara to expand south. Overgrazing by cattle removes vegetation, allowing wind to blow away fertile topsoil.",
    "Civil Conflict": "The human factor in Darfur. War between groups leads to the destruction of crops and 'scorched earth' tactics, making farming impossible.",
    "Farmer Displacement": "Millions fled to IDP camps like Kalma. Because they were in camps, they couldn't plant during the rainy season, leading to a total harvest failure.",
    "Aid Blockades": "During the conflict, food aid trucks were often hijacked or blocked, meaning even when the world sent food, it couldn't reach those in need.",
    "Post-Oil Diversification": "The UAE realized oil is finite. They invested oil profits into tourism infrastructure to ensure the economy survives once the oil wells run dry.",
    "Iconic Architecture": "Using 'World Firsts' like the Burj Khalifa to put Dubai on the map, creating a brand that attracts millions of high-spending international tourists.",
    "Hub Geography": "Dubai's location between Europe and Asia makes it a perfect stopover. Emirates Airline turned this location into a major economic advantage.",
    "Luxury Branding": "Focusing on 5-star and 7-star experiences. This ensures high revenue even with lower visitor numbers compared to mass-market destinations.",
    "Tectonic Hotspot": "Iceland sits on the Mid-Atlantic Ridge where plates pull apart. This allows magma to heat underground water, creating free steam for energy.",
    "Geothermal Heating": "90% of Icelandic homes are heated by natural hot water pumped from the ground, drastically reducing the cost of living and carbon emissions.",
    "Glacial Hydro-Power": "Melting glaciers provide powerful rivers. Iceland builds dams on these rivers to provide cheap, clean electricity for heavy industries like aluminum smelting.",
    "Zero Carbon Grid": "By combining volcanic and water power, Iceland has removed the need for fossil fuel power plants, achieving total energy security.",
    
    // Universal Deep-Dive Additions for other sections
    "Arable: Crops": "Focuses on plant production. Requires high-quality soil and temperate climates. Vulnerable to market price drops.",
    "Pastoral: Animals": "Livestock rearing. Used in areas where land is too steep or climate too wet for reliable crop growth.",
    "Intensive: High Input": "High capital/labor per hectare. Aims for maximum yield. Common in garden centers or high-tech dairy farms.",
    "Extensive: Large Land": "Low inputs over vast areas. Low yield per hectare but low cost of production (e.g., Australian sheep stations).",
    "Nomadic Herding": "Moving livestock based on seasonal rainfall. Essential for survival in arid environments like the Sahel.",
    "Sedentary Subsistence": "Permanent farming for family use. Uses simple tools and traditional knowledge passed through generations.",
    "Fallow Periods": "Resting soil for 1-5 years to allow natural nitrogen fixation and organic matter buildup.",
    "LEDC context": "Lower Economically Developed Countries where 60%+ of the workforce may be in agriculture for survival.",
    "Monoculture": "Single crop specialization. Efficient for machinery but creates ecological 'deserts' and high pest risk.",
    "Plantation Farming": "Colonial-style large estates producing cash crops for global markets (bananas, sugar, palm oil).",
    "Agribusiness": "Integration of farming into a global industrial chain, prioritizing profit and efficiency over local food security.",
    "High-Tech Yields": "Using precision GPS, vertical farming, and genetically modified seeds to maximize caloric output.",
    "Flooding/Cyclones": "Destroys infrastructure and topsoil. Saturated ground kills root systems and leads to harvest loss.",
    "Locust Swarms": "A biological disaster where swarms consume an area's entire food supply in hours, requiring international intervention.",
    "Soil Exhaustion": "The depletion of minerals due to continuous cropping without fertilizer or rest periods.",
    "Climate Change": "Long-term shifts in temperature and rainfall that make traditional crop varieties unviable in their native regions.",
    "Infrastructure Gaps": "Poor road networks and lack of cold-chain storage leading to post-harvest losses of up to 40%.",
    "Export Focus": "Prioritizing high-value cash crops for international trade while local populations suffer from malnutrition.",
    "Price Volatility": "Speculation in global markets causing sudden spikes in the cost of staples like rice and wheat.",
    "Refugee Crisis": "Disruption of farming cycles as populations flee conflict, turning producers into aid-dependent consumers.",
    "Long-term Stunting": "Permanent physical and cognitive development delays in children due to chronic lack of protein and calories.",
    "Aid Dependency": "The breakdown of local market structures when free food aid discourages local farmers from producing.",
    "Social Unrest": "Political instability triggered by 'food riots' when basic staples become unaffordable.",
    "NGO Intervention": "Agencies like MSF or Oxfam providing therapeutic feeding and seeds to stabilize vulnerable populations.",
    "Advertising": "Global marketing to build 'destination desire'—critical for competing in a crowded global tourism market.",
    "Package Holidays": "Vertically integrated travel where one company owns the flight, hotel, and tours, increasing leakage.",
    "Niche Tourism": "Specialized markets (e.g., ecotourism, adventure, dark tourism) that attract high-spending travelers.",
    "Accessibility": "The proximity to international airports and high-speed rail. The #1 predictor of tourism growth.",
    "Direct Jobs": "Employment that exists only because of the tourist (e.g., flight attendants, hotel staff).",
    "Indirect Jobs": "Supply chain jobs (e.g., construction workers building hotels, local farmers selling to resorts).",
    "Foreign Exchange": "Hard currency used to pay for national imports and improve the country's balance of payments.",
    "Infrastructure Tax": "Revenue from tourist visas or hotel taxes used to fund local public services.",
    "Cultural Erosion": "The commodification of traditions where sacred rituals are performed as shallow entertainment.",
    "Seasonal Unemployment": "Economic vulnerability for workers during the 'low season' when tourist arrivals drop.",
    "Inflation": "Increased living costs for locals as tourists drive up the price of land, food, and energy.",
    "Habitat Loss": "Destruction of biodiversity hotspots (beaches, forests) to build high-density accommodation.",
    "Pipe Leakage": "Infrastructure failure where treated water escapes before reaching the consumer (major issue in Seychelles).",
    "Desalination Costs": "The high energy requirement (often fossil fuel based) to filter salt from seawater at scale.",
    "Reservoir Needs": "Storage of wet-season surplus to ensure year-round supply for both locals and tourists.",
    "Rainy Season Capture": "Effective management of monsoon or tropical rains to prevent runoff into the ocean.",
    "Rainwater Harvesting": "Collection of water at the source (roofs) to reduce demand on central utility networks.",
    "Graywater Recycling": "Treating water from baths/sinks for non-potable uses like landscaping and toilets.",
    "Public Education": "Behavioral change programs to encourage water-saving habits among residents and visitors.",
    "Infrastructure Loan": "The long-term debt burden taken by small island states to fund major utility upgrades.",
    "Carrying Capacity": "The specific threshold of visitors an environment can host without permanent degradation.",
    "Zoning Grounds": "Restricting human activity to certain areas to protect sensitive wildlife habitats.",
    "Carbon Offsetting": "Financial contributions to green projects to compensate for the emissions of long-haul travel.",
    "Local Sourcing": "Ensuring hotels buy from local producers to maximize the multiplier effect and minimize leakage.",
    "Oil Spills": "The ecological disaster risk of transporting crude oil, which can destroy coastal tourism for decades.",
    "Methane Release": "The leakage of natural gas during extraction—a greenhouse gas 25-80x more potent than CO2.",
    "Finite Resource": "Energy sources that do not regenerate on a human timescale (coal, oil, gas, uranium).",
    "Technological Maturity": "The reliability of established energy systems vs. the unproven nature of emerging tech.",
    "Solar Power": "Harnessing the photovoltaic effect. Best in equatorial regions but requires storage for 24/7 use.",
    "Wind Intermittency": "The variability of wind speed which requires a flexible grid or fossil fuel backup power.",
    "Hydroelectric Dams": "Massive clean energy output but involves flooding land and disrupting river ecology.",
    "Energy Mix Policy": "Diversifying energy sources to ensure national security if one supply chain fails.",
    "Fuel Poverty": "When rising energy prices force low-income households to choose between heating and food.",
    "Home Insulation": "The most cost-effective way to reduce energy demand (e.g., double glazing, loft insulation).",
    "Fracking/Shale Gas": "Hydraulic fracturing to release trapped gas—linked to tremors and groundwater contamination.",
    "Waste Storage": "The geological problem of securing nuclear byproducts for thousands of years."
  };

  const sections = {
    "Agricultural Systems": {
      icon: <BookOpen className="w-5 h-5" />,
      tagline: "A deep dive into farming systems, inputs, and the global classification of food production.",
      details: [
        { 
          title: "1. The System Model & Classifications", 
          text: "Farming is an open system with inputs, processes, and outputs. Inputs are divided into Physical (temperature, rainfall over 1000mm, fertile loam soils) and Human (labor, capital for machinery, government subsidies). Processes include harvesting and sowing, while outputs include the product (meat/crops) and waste (manure/runoff).",
          subpoints: ["Arable: Crops", "Pastoral: Animals", "Intensive: High Input", "Extensive: Large Land"]
        },
        { 
          title: "2. Subsistence Systems & Shifting Cultivation", 
          text: "Subsistence farming focuses on survival. A key example is Shifting Cultivation (Slash and Burn) practiced in the Amazon. Farmers clear small forest patches, burn vegetation for nutrients, and farm for 2-3 years until soil exhaustion, then move to allow forest regeneration.",
          subpoints: ["Nomadic Herding", "Sedentary Subsistence", "Fallow Periods", "LEDC context"]
        },
        { 
          title: "3. Commercial Systems & Green Revolution", 
          text: "Commercial farming is profit-driven and large-scale. The 'Green Revolution' introduced HYVs (High Yielding Varieties), chemical fertilizers, and modern irrigation to LEDCs like India. While it increased food security, it led to heavy farmer debt and environmental pesticide runoff.",
          subpoints: ["Monoculture", "Plantation Farming", "Agribusiness", "High-Tech Yields"]
        }
      ],
      prompt: "A split-screen comparison: Amazonian shifting cultivation with smoke rising vs. a massive, high-tech commercial wheat harvest."
    },
    "Food Shortages": {
      icon: <Utensils className="w-5 h-5" />,
      tagline: "Analyzing why food insecurity persists despite global abundance.",
      details: [
        { 
          title: "1. Physical Triggers: Drought & Soil", 
          text: "Physical causes include prolonged drought in regions like the Sahel. Desertification is accelerated by overgrazing, where removing vegetation allows wind to blow away fertile topsoil, leaving unproductive dust.",
          subpoints: ["Flooding/Cyclones", "Locust Swarms", "Soil Exhaustion", "Climate Change"]
        },
        { 
          title: "2. Human Triggers: Conflict & Economics", 
          text: "War and civil unrest prevent farmers from planting and disrupt aid delivery. High population growth often exceeds the 'carrying capacity' of the land, leading to a Malthusian crisis where food supply cannot meet demand.",
          subpoints: ["Infrastructure Gaps", "Export Focus", "Price Volatility", "Refugee Crisis"]
        },
        { 
          title: "3. Case Study: Famine in Ethiopia", 
          text: "Ethiopia has suffered famines caused by a combination of rain failure (physical) and civil war/poor transport (human). Impacts include widespread malnutrition, death from hunger-related diseases, and mass migration to refugee camps.",
          subpoints: ["Long-term Stunting", "Aid Dependency", "Social Unrest", "NGO Intervention"]
        }
      ],
      prompt: "A parched landscape in the Horn of Africa with dried-up riverbeds and a distant aid truck."
    },
    "Tourism": {
      icon: <Map className="w-5 h-5" />,
      tagline: "The global explosion of the leisure industry and its socio-economic impacts.",
      details: [
        { 
          title: "1. Growth Factors & The Butler Model", 
          text: "Growth is driven by increased disposable income and low-cost airlines. The Butler Model tracks a resort's life cycle from Discovery and Involvement to Stagnation and either Decline or Rejuvenation.",
          subpoints: ["Advertising", "Package Holidays", "Niche Tourism", "Accessibility"]
        },
        { 
          title: "2. Economic Multiplier & Leakage", 
          text: "The 'Multiplier Effect' describes how tourist spending creates a chain reaction in the economy. However, 'Economic Leakage' occurs when profits flow out to international hotel chains and tour operators.",
          subpoints: ["Direct Jobs", "Indirect Jobs", "Foreign Exchange", "Infrastructure Tax"]
        },
        { 
          title: "3. Social & Environmental Tensions", 
          text: "Tourism can lead to the 'Demonstration Effect,' where locals imitate wealthy tourists, eroding culture. Environmentally, resorts often destroy mangrove forests and coral reefs through sewage or construction.",
          subpoints: ["Cultural Erosion", "Seasonal Unemployment", "Inflation", "Habitat Loss"]
        }
      ],
      prompt: "A bustling resort area with high-rise hotels and heavy traffic vs. a quiet traditional village."
    },
    "Sustainability": {
      icon: <Leaf className="w-5 h-5" />,
      tagline: "Management strategies for preserving resources in a world of mass travel.",
      details: [
        { 
          title: "1. Case Study: Seychelles Water Crisis", 
          text: "Seychelles faces water shortages during the dry season. A US$25M desalination investment is hindered by 75% water loss through old, leaking pipes. This affects tourism, with reports of tourists encountering restricted water in public facilities.",
          subpoints: ["Pipe Leakage", "Desalination Costs", "Reservoir Needs", "Rainy Season Capture"]
        },
        { 
          title: "2. Resource Management Solutions", 
          text: "Replacing infrastructure (leaking pipes) is often more cost-effective than increasing supply. Building reservoirs to catch abundant rainwater during the wet season is a cheaper, lower-energy alternative.",
          subpoints: ["Rainwater Harvesting", "Graywater Recycling", "Public Education", "Infrastructure Loan"]
        },
        { 
          title: "3. Ecotourism: A Better Path?", 
          text: "Ecotourism aims to be small-scale and high-value. It uses local materials, employs local guides to minimize leakage, and educates tourists on conservation to ensure the environment is 'better off'.",
          subpoints: ["Carrying Capacity", "Zoning Grounds", "Carbon Offsetting", "Local Sourcing"]
        }
      ],
      prompt: "A cross-section of a sustainable hotel with solar panels and a rainwater collection tank."
    },
    "Energy": {
      icon: <Zap className="w-5 h-5" />,
      tagline: "The transition from carbon-heavy fossil fuels to a sustainable energy mix.",
      details: [
        { 
          title: "1. Fossil Fuels & Global Warming", 
          text: "Coal, Oil, and Natural Gas provide 80% of global energy. They are reliable but drive the Enhanced Greenhouse Effect. Coal is the most polluting, releasing high CO2 and SO2 (acid rain).",
          subpoints: ["Oil Spills", "Methane Release", "Finite Resource", "Technological Maturity"]
        },
        { 
          title: "2. The Renewable Energy Mix", 
          text: "The 'Energy Mix' refers to the contribution of different sources. The UK has reduced coal to near zero by increasing wind power to 25%+. Renewables are sustainable but face intermittency issues.",
          subpoints: ["Solar Power", "Wind Intermittency", "Hydroelectric Dams", "Energy Mix Policy"]
        },
        { 
          title: "3. Energy Security & Nuclear Debate", 
          text: "Energy security means a reliable supply. Nuclear is zero-CO2 but controversial due to accident risks (Chernobyl/Fukushima) and radioactive waste. Fracking is a modern alternative with earthquake risks.",
          subpoints: ["Fuel Poverty", "Home Insulation", "Fracking/Shale Gas", "Waste Storage"]
        }
      ],
      prompt: "A traditional coal power plant being dismantled with wind turbines in the foreground."
    },
    "Case Study Vault": {
      icon: <Star className="w-5 h-5" />,
      tagline: "Deep dives into the specific case studies from your syllabus.",
      details: [
        { 
          title: "CS1: Famine & Conflict in Darfur, Sudan", 
          text: "Darfur demonstrates how environmental fragility and human tragedy interact. A massive drought led to desertification, pushing nomadic herders onto the land of sedentary farmers. This competition for dwindling water and fertile soil sparked a civil war. Human triggers like scorched-earth tactics and aid blockades transformed a seasonal shortage into a long-term famine that killed hundreds of thousands.",
          subpoints: ["Drought & Desertification", "Civil Conflict", "Farmer Displacement", "Aid Blockades"],
          caseStudy: "Darfur, Sudan",
          outcome: "Environmental stress creates competition, but human conflict creates catastrophe."
        },
        { 
          title: "CS2: Tourism Diversification in Dubai, UAE", 
          text: "Dubai is the world's most aggressive example of economic diversification. Faced with the eventual exhaustion of oil, the government invested billions into infrastructure. By utilizing its geographic position as a global 'hub' between East and West, and building unique attractions like the Palm Jumeirah and Burj Khalifa, Dubai successfully shifted from a resource-based economy to a high-value service and tourism economy.",
          subpoints: ["Post-Oil Diversification", "Iconic Architecture", "Hub Geography", "Luxury Branding"],
          caseStudy: "Dubai, UAE",
          outcome: "Tourism is a survival strategy to replace finite natural resources."
        },
        { 
          title: "CS3: Geothermal & Hydro-Power in Iceland", 
          text: "Iceland's energy policy is dictated entirely by its unique physical geography. Sitting on the Mid-Atlantic Ridge (a divergent plate boundary), it has infinite access to geothermal steam. Simultaneously, its massive glaciers feed high-energy rivers perfect for hydro-power. By harnessing these local 'gifts,' Iceland has achieved near-total energy independence and one of the lowest carbon footprints in the world.",
          subpoints: ["Tectonic Hotspot", "Geothermal Heating", "Glacial Hydro-Power", "Zero Carbon Grid"],
          caseStudy: "Iceland",
          outcome: "Total energy security is possible when a nation aligns its economy with its physical geography."
        }
      ],
      prompt: "A collage of a dry Darfur aid camp, the Dubai Burj Khalifa, and an Icelandic geothermal plant."
    }
  };

  const generateImage = async (sectionName, retryCount = 0) => {
    if (sectionImages[sectionName]) return;
    setLoadingImage(true);
    setErrorMessage(null);
    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          instances: [{ prompt: sections[sectionName].prompt }],
          parameters: { sampleCount: 1 }
        })
      });
      if (!response.ok) throw new Error(`API error: ${response.status}`);
      const result = await response.json();
      if (result.predictions?.[0]?.bytesBase64Encoded) {
        const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
        setSectionImages(prev => ({ ...prev, [sectionName]: imageUrl }));
      }
    } catch (error) {
      if (retryCount < 3) {
        setTimeout(() => generateImage(sectionName, retryCount + 1), 2000);
      } else {
        setErrorMessage("Visual generation failed.");
      }
    } finally {
      setLoadingImage(false);
    }
  };

  useEffect(() => {
    generateImage(activeTab);
  }, [activeTab]);

  return (
    <div className="min-h-screen bg-[#f8fafc] text-[#0f172a] font-sans pb-20">
      {/* Navigation */}
      <nav className="sticky top-0 z-50 bg-white/90 backdrop-blur-lg border-b border-slate-200">
        <div className="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="bg-gradient-to-br from-indigo-600 to-blue-700 p-2.5 rounded-xl text-white shadow-lg">
              <Globe className="w-6 h-6" />
            </div>
            <div>
              <span className="font-black text-2xl tracking-tighter text-slate-900 block leading-none">GEO-STUDY</span>
              <span className="text-[10px] font-bold text-indigo-600 uppercase tracking-[0.2em]">S2 Finals Master</span>
            </div>
          </div>
          <div className="hidden lg:flex gap-1.5">
            {Object.keys(sections).map((name) => (
              <button
                key={name}
                onClick={() => setActiveTab(name)}
                className={`px-4 py-2.5 rounded-xl text-sm font-bold transition-all ${
                  activeTab === name 
                    ? "bg-indigo-600 text-white shadow-md shadow-indigo-100 scale-105" 
                    : "text-slate-500 hover:bg-slate-50"
                }`}
              >
                {name}
              </button>
            ))}
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-10">
        {/* Left Column (Visuals) */}
        <div className="lg:col-span-5 space-y-8">
          <div className="bg-white rounded-[2.5rem] shadow-xl shadow-slate-200/40 border border-slate-200 overflow-hidden sticky top-28">
            <div className="relative h-96 bg-slate-100 flex items-center justify-center">
              {loadingImage && !sectionImages[activeTab] ? (
                <div className="flex flex-col items-center gap-4">
                  <div className="w-12 h-12 border-4 border-indigo-100 border-t-indigo-600 rounded-full animate-spin"></div>
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Generating Concept...</p>
                </div>
              ) : sectionImages[activeTab] ? (
                <>
                  <img src={sectionImages[activeTab]} alt={activeTab} className="w-full h-full object-cover" />
                  <button 
                    onClick={() => { setSectionImages(p => ({...p, [activeTab]: null})); generateImage(activeTab); }}
                    className="absolute bottom-4 right-4 bg-white/50 backdrop-blur p-2 rounded-full text-indigo-600 hover:bg-white transition-all shadow-sm"
                  >
                    <RefreshCw className="w-4 h-4" />
                  </button>
                </>
              ) : (
                <div className="text-center p-8">
                  <ImageIcon className="w-16 h-16 text-slate-200 mx-auto mb-4" />
                  <button onClick={() => generateImage(activeTab)} className="text-indigo-600 font-bold hover:underline">Retry Visual</button>
                </div>
              )}
              <div className="absolute top-4 left-4 bg-white/90 backdrop-blur px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wider text-indigo-600 shadow-sm border border-slate-100">
                Visual Context
              </div>
            </div>
            <div className="p-10">
              <h1 className="text-4xl font-black text-slate-900 mb-4 tracking-tight leading-none">{activeTab}</h1>
              <p className="text-slate-500 text-lg leading-relaxed font-medium">{sections[activeTab].tagline}</p>
            </div>
          </div>
        </div>

        {/* Right Column (Details) */}
        <div className="lg:col-span-7 space-y-8">
          {sections[activeTab].details.map((detail, idx) => (
            <section key={idx} className={`bg-white rounded-[2rem] p-8 shadow-sm border ${detail.caseStudy ? 'border-indigo-200 bg-indigo-50/20 ring-1 ring-indigo-100' : 'border-slate-200'}`}>
              <div className="flex flex-col gap-6">
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-4">
                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-bold text-sm ${detail.caseStudy ? 'bg-indigo-600 text-white' : 'bg-slate-100 text-slate-400'}`}>
                      {detail.caseStudy ? <MapPin className="w-5 h-5" /> : idx + 1}
                    </div>
                    <h3 className={`text-2xl font-black tracking-tight ${detail.caseStudy ? 'text-indigo-900' : 'text-slate-800'}`}>
                      {detail.title}
                    </h3>
                  </div>
                  <span className="text-[10px] font-black bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full uppercase tracking-widest">
                    Interactive {detail.caseStudy ? 'Vault' : ''}
                  </span>
                </div>
                
                <p className="text-slate-600 leading-relaxed text-lg font-medium">
                  {detail.text}
                </p>

                {detail.subpoints && (
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    {detail.subpoints.map((p, i) => (
                      <button 
                        key={i} 
                        onClick={() => tagDefinitions[p] ? setSelectedTag({ title: p, description: tagDefinitions[p] }) : null}
                        className={`group flex items-center justify-between gap-2 p-3 rounded-xl border transition-all text-left ${
                          tagDefinitions[p] 
                            ? "bg-white border-indigo-100 hover:border-indigo-500 hover:shadow-md cursor-pointer" 
                            : "bg-slate-50 border-slate-100 cursor-default"
                        }`}
                      >
                        <div className="flex items-center gap-2 overflow-hidden">
                          <div className={`w-1.5 h-1.5 rounded-full shrink-0 ${tagDefinitions[p] ? 'bg-indigo-500 animate-pulse' : 'bg-slate-300'}`} />
                          <span className={`text-[11px] font-bold uppercase tracking-tight truncate ${tagDefinitions[p] ? 'text-indigo-700' : 'text-slate-500'}`}>
                            {p}
                          </span>
                        </div>
                        {tagDefinitions[p] && <MousePointer2 className="w-3 h-3 text-indigo-300 group-hover:text-indigo-600 transition-colors" />}
                      </button>
                    ))}
                  </div>
                )}

                {detail.outcome && (
                  <div className="bg-indigo-600 rounded-2xl p-6 text-white flex gap-4 shadow-lg shadow-indigo-100">
                    <div className="bg-white/20 p-2 rounded-xl h-fit">
                      <Lightbulb className="w-6 h-6" />
                    </div>
                    <div>
                       <p className="text-[10px] font-black text-indigo-200 uppercase tracking-widest mb-1 underline decoration-indigo-300 underline-offset-4">Core Lesson</p>
                       <p className="text-lg font-bold leading-snug">{detail.outcome}</p>
                    </div>
                  </div>
                )}
              </div>
            </section>
          ))}
        </div>
      </main>

      {/* Modal for Interactive Tags */}
      {selectedTag && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-sm">
          <div className="bg-white w-full max-w-md rounded-[2.5rem] shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200">
            <div className="bg-indigo-600 p-8 text-white relative">
              <button 
                onClick={() => setSelectedTag(null)}
                className="absolute top-6 right-6 p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors"
              >
                <X className="w-5 h-5" />
              </button>
              <div className="bg-white/20 w-12 h-12 rounded-2xl flex items-center justify-center mb-4">
                <Info className="w-6 h-6" />
              </div>
              <h2 className="text-xs font-black uppercase tracking-[0.3em] opacity-80 mb-2">Detailed Analysis</h2>
              <h3 className="text-3xl font-black tracking-tight leading-tight">{selectedTag.title}</h3>
            </div>
            <div className="p-8">
              <p className="text-slate-600 text-lg leading-relaxed font-medium">
                {selectedTag.description}
              </p>
              <button 
                onClick={() => setSelectedTag(null)}
                className="w-full mt-8 bg-slate-900 text-white font-black py-4 rounded-2xl hover:bg-slate-800 transition-all uppercase tracking-widest text-sm"
              >
                Close Insights
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Mobile Bottom Nav */}
      <div className="lg:hidden fixed bottom-6 left-6 right-6 bg-white/90 backdrop-blur-2xl border border-slate-200 rounded-[1.5rem] shadow-2xl flex items-center justify-around p-2 z-50">
        {Object.keys(sections).map((name) => (
          <button
            key={name}
            onClick={() => setActiveTab(name)}
            className={`p-4 rounded-xl transition-all ${
              activeTab === name ? "bg-indigo-600 text-white shadow-lg" : "text-slate-400"
            }`}
          >
            {React.cloneElement(sections[name].icon, { className: "w-5 h-5" })}
          </button>
        ))}
      </div>
    </div>
  );
};

export default App;
